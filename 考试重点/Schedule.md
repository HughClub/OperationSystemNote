# 调度与死锁

## 调度

调度的任务

-   保存CPU现场信息
-   按算法选取进程
-   分配CPU给进程

调度机制的三部分

-   排队器
-   分派器
-   上下文切换器



抢占的主要原则

-   优先级原则
-   短进程优先原则
-   时间片原则



RR(Round Robin)算法

>   时间片越长 平均周转时间越短



### 层次

|          | 别名          | 对象 | 功能                       |
| -------- | ------------- | ---- | -------------------------- |
| 高级调度 | 长程/作业调度 | 作业 | 将外存后备队列作业调入内存 |
| 低级调度 | 短程/进程调度 | 进程 | 决定就绪队列运行的进程     |
| 中级调度 | 内存调度      | 内存 | 对换功能(挂起和重装入)     |

$$
{\rm{usage}}\;=\frac{work}{work+wait}
$$



#### CPU调度目的

-   资源利用率
-   公平性
-   平衡性
-   策略强制执行



#### 批处理系统目标

-   平均周转时间段
-   系统吞吐量高
-   CPU利用率高

>   周转时间:作业提交到系统到完成的时间

带权周转时间:作业的周转时间 $T$ 与系统为它提供服务的时间 $T_s$ 之比

即 $W=\cfrac{T}{T_s}$

平均带权周转时间
$$
W\;=\,\frac{1}{n}\sum_{i=1}^n\frac{T_i}{T_s}
$$

#### 分时系统目标

-   响应时间快
    -   输入
    -   处理
    -   回送
-   均衡性

#### 实时系统目标

-   截至时间的保证
-   可预测性

### 调度算法



#### FCFS

#### SJF

短作业优先:用作业长度计算优先级

#### PSA

优先级调度算法(priority-scheduling algorithm)

定义外部作业优先级

#### HRRN

高响应比优先调度算法

相当于PSA加上一个aging机制(未调度进程优先级一段时间后提升)



### 实时调度

#### EDF

最早截止时间优先

根据任务的截止时间确定任务的优先级

#### LLF

最低松弛度优先(least laxity first)

根据任务的紧急程度

比如一个任务需要300ms时必须完成 本身需要运行时间是100ms 所以紧急程度是200ms

## 死锁

### 必要条件

-   互斥
-   请求和保持
-   不可抢占
-   循环等待

### 处理死锁

-   预防死锁:破坏死锁条件
-   避免死锁:资源分配时 防止系统不安全操作
-   检测死锁
-   解除死锁

#### 银行家算法

四个数据结构

-   可用资源向量Available:m维数组
-   最大需求矩阵Max:n$\times$m矩阵 n个进程对m中资源的最大需求
-   分配矩阵Allocation:每类资源分配给进程的数量
-   需求矩阵Need:每个进程尚需各类资源数

$Need[i,i]=Max[i,j]-Allocation[i,j]$

安全性算法:在当前时刻能找到一个安全序列 使得所有进程按序列占有资源后释放

1.  如果能够满足要求:预分配
2.  然后计算剩余+已分配能否得到安全序列

